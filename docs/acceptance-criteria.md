# Google Drive Backend 蔵書管理アプリ 検収項目書

**文書バージョン:** 2.0
**作成日:** 2026-02-15
**対応要件定義書:** Google Drive Backend 蔵書管理アプリ 要件定義書

---

## 目次

1. [本文書の目的と読み方](#1-本文書の目的と読み方)
2. [用語定義](#2-用語定義)
3. [Phase 1: Web UI & CRUD 検収項目](#3-phase-1-web-ui--crud-検収項目)
   - 3.1 [書籍登録 (Uploader)](#31-書籍登録-uploader)
   - 3.2 [ライブラリ閲覧 (Browser)](#32-ライブラリ閲覧-browser)
   - 3.3 [書籍削除](#33-書籍削除)
   - 3.4 [書籍編集](#34-書籍編集)
   - 3.5 [認証・設定](#35-認証設定)
4. [Phase 2: OPDS & Mobile Access 検収項目](#4-phase-2-opds--mobile-access-検収項目)
   - 4.1 [OPDSサーバー](#41-opdsサーバー)
   - 4.2 [パフォーマンス最適化](#42-パフォーマンス最適化)
5. [データ設計 検収項目](#5-データ設計-検収項目)
6. [非機能要件 検収項目](#6-非機能要件-検収項目)
7. [総合試験シナリオ](#7-総合試験シナリオ)

---

## 1. 本文書の目的と読み方

本文書は、要件定義書に基づきシステムが正しく動作することを検証するための**検収項目（受け入れ試験項目）**を定義する。

### 優先度の定義

| 優先度 | 意味 |
|--------|------|
| **必須** | この項目がPassしない限り、該当Phaseの検収を合格としない |
| **重要** | 基本的にPassが求められるが、既知の制約として合意があれば条件付き合格とする |
| **推奨** | Passが望ましいが、未対応でも検収合格とする |

### テスト結果の記録

各項目に対し、以下のいずれかを記録する:
- **Pass**: 期待結果を満たしている
- **Fail**: 期待結果を満たしていない
- **N/A**: 該当Phaseでは対象外
- **条件付きPass**: 既知の制約に基づき許容する（理由を備考に記載）

---

## 2. 用語定義

| 用語 | 定義 |
|------|------|
| **カスタムプロパティ** | Google Drive APIの `properties` フィールド。ファイルに付与可能なKey-Valueメタデータ |
| **管理対象ファイル** | Google Drive上の `MyLibrary` フォルダ配下に存在し、かつカスタムプロパティ `app_type=my_library_book` を持つファイル |
| **管理対象フォルダ** | Google Drive上の `MyLibrary` という名前のフォルダ。このフォルダ以下のすべてのサブフォルダがアプリの管理対象となる。書籍の検索・登録はすべてこのフォルダ以下で行われる |
| **書誌情報** | ISBN, タイトル, 著者名, 出版社, 出版日, 概要, カバー画像URLの一式 |
| **SSR** | Server-Side Rendering。サーバー側でHTMLを生成してクライアントに返す方式 |
| **OPDS** | Open Publication Distribution System。電子書籍カタログの配信規格（Atom Feed形式） |

---

## 3. Phase 1: Web UI & CRUD 検収項目

### 3.1 書籍登録 (Uploader)

#### 3.1.1 ISBN検索・書誌情報補完

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| REG-001 | ISBN入力による書誌情報取得（OpenBD） | アプリが起動している。インターネット接続がある | 1. 書籍登録画面を開く<br>2. OpenBDに存在する日本語書籍のISBN（例: `9784101010014`）を入力する | タイトル、著者名、出版社、出版日、概要、カバー画像URLがフォームに自動補完される | 必須 |
| REG-002 | ISBN入力による書誌情報取得（Google Booksフォールバック） | アプリが起動している。インターネット接続がある | 1. 書籍登録画面を開く<br>2. OpenBDに存在しないがGoogle Booksに存在するISBN（英語書籍等）を入力する | OpenBDで取得できなかった場合にGoogle Books APIへフォールバックし、書誌情報がフォームに自動補完される | 必須 |
| REG-003 | 両方のAPIで見つからないISBN | インターネット接続がある | 1. 存在しないISBN（例: `0000000000000`）を入力する | 「書誌情報が見つかりませんでした」等のメッセージが表示され、手動入力が可能な状態となる | 必須 |
| REG-004 | 取得した書誌情報の手動修正 | REG-001でフォームに書誌情報が補完された状態 | 1. 自動補完されたタイトルや著者名を手動で編集する | 編集した内容がそのまま登録データとして使用される（上書き可能である） | 必須 |
| REG-006 | ISBN未入力での手動登録 | アプリが起動している | 1. ISBNを入力せずにタイトル・著者名等を手動入力する<br>2. ファイルを添付して登録する | ISBN無しでも書籍として登録できる | 重要 |
| REG-007 | 取得項目の網羅性確認 | REG-001で書誌情報が取得された状態 | 1. 取得された情報に以下が含まれることを確認する: タイトル、著者名、出版社、出版日、概要、カバー画像URL | 6項目すべてが取得・表示される（外部APIにデータが存在する項目に限る） | 必須 |

#### 3.1.2 ファイルアップロード

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| UPL-003 | EPUB/PDF以外のファイル拒否 | アプリが起動している | 1. JPGファイルなど、EPUB/PDF以外のファイルをアップロードしようとする | アップロードが拒否され、対応ファイル形式に関するエラーメッセージが表示される | 必須 |
| UPL-004 | ファイル選択ダイアログからのアップロード | 書誌情報が入力済み | 1. アップロード領域をクリックする（またはファイル選択ボタンを押す）<br>2. ファイル選択ダイアログからEPUBを選択する<br>3. 「登録」ボタンを押す | ドラッグ＆ドロップ以外にも、ファイル選択ダイアログ経由でアップロードできる | 推奨 |
| UPL-005 | アップロード中のプログレス表示 | 大きなファイル（50MB以上）を用意 | 1. ファイルをアップロードする | アップロード中であることがユーザーに視覚的にフィードバックされる（プログレスバー、スピナー等） | 重要 |
| UPL-006 | 書誌情報未入力でのアップロード防止 | アプリが起動している | 1. 書誌情報（タイトル）を一切入力せずにファイルをアップロードしようとする | タイトルが未入力の場合、登録ボタンが無効化されるか、バリデーションエラーが表示される | 必須 |

#### 3.1.3 Driveへの保存処理

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| DRV-001 | ファイル名の自動リネーム（EPUB） | 著者名「太宰治」、タイトル「人間失格」のEPUBをアップロード | 1. 登録を実行する<br>2. Google Drive上のファイル名を確認する | ファイル名が `[太宰治] 人間失格.epub` 形式になっている | 必須 |
| DRV-002 | ファイル名の自動リネーム（PDF） | 著者名「夏目漱石」、タイトル「坊っちゃん」のPDFをアップロード | 1. 登録を実行する<br>2. Google Drive上のファイル名を確認する | ファイル名が `[夏目漱石] 坊っちゃん.pdf` 形式になっている | 必須 |
| DRV-003 | カスタムプロパティの書き込み | 書籍を1冊登録する | 1. 登録完了後、Drive APIでファイルのプロパティを取得する | `app_type`, `isbn`, `title`, `authors`, `publisher`, `published_date` がすべて正しく設定されている | 必須 |
| DRV-004 | フォルダ構成の確認 | 書籍を1冊登録する | 1. Google Driveのフォルダ構造を確認する | `/MyLibrary/著者名/` 配下にファイルが保存されている | 必須 |
| DRV-005 | 著者名フォルダの自動作成 | 新規著者の書籍を登録する | 1. まだフォルダが存在しない著者名の書籍を登録する | 著者名のフォルダが自動で作成され、その配下にファイルが保存される | 必須 |
| DRV-006 | 同一著者の2冊目登録 | 同一著者の書籍がすでに1冊登録されている | 1. 同一著者の別の書籍を登録する | 既存の著者名フォルダ内に新しいファイルが追加される（フォルダの重複作成がない） | 必須 |
| DRV-007 | 複数著者の場合のファイル名とフォルダ | 著者名が「著者A-著者B」の書籍を登録する | 1. 登録を実行する<br>2. ファイル名とフォルダ構成を確認する | ファイル名が `[著者A-著者B] タイトル.拡張子` 形式になっている。フォルダは第一著者（著者A）のフォルダ `/MyLibrary/著者A/` 配下に保存される | 重要 |
| DRV-008 | app_typeプロパティの値確認 | 書籍を1冊登録する | 1. Drive APIでプロパティを確認する | `app_type` の値が `my_library_book` である | 必須 |
| DRV-009 | ISBN未入力時のプロパティ | ISBNを入力せずに書籍を登録する | 1. Drive APIでプロパティを確認する | `isbn` プロパティが空文字列またはキー自体が存在しない（エラーにならない） | 重要 |
| DRV-010 | カバー画像のDriveへの保存 | 外部APIからカバー画像URLが取得できる書籍を登録 | 1. 書籍を登録する<br>2. Google Drive上のファイルを確認する | カバー画像ファイルが書籍ファイルと同じフォルダ（または関連付けられた場所）にGoogle Drive上に保存されている | 必須 |
| DRV-011 | カバー画像が取得できない場合 | 外部APIからカバー画像URLが取得できない書籍を登録 | 1. 書籍を登録する | カバー画像が無くても書籍登録自体はエラーにならず正常に完了する | 重要 |

#### 3.1.4 登録フロー全体

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| FLW-001 | 登録成功時のフィードバック | アプリが起動している | 1. ISBN入力→書誌情報取得→ファイル選択→登録の一連のフローを実行する | 登録成功のメッセージが表示され、フォームがリセットされる（または次の登録が可能な状態になる） | 必須 |
| FLW-002 | 登録失敗時のエラーハンドリング（Drive API障害） | Google Drive APIへの接続が不安定な状態を模擬 | 1. ファイルをアップロードして登録を試みる | 明確なエラーメッセージが表示され、再試行が可能な状態となる | 必須 |
| FLW-003 | 「登録」ボタン押下前の確認 | ISBN入力で書誌情報が補完された状態 | 1. 書誌情報が画面上に表示されていることを確認する<br>2. 情報を確認してから「登録」ボタンを押す | 登録前に書誌情報を確認・修正する画面が提供されている | 必須 |
| FLW-004 | 重複ISBN登録時の上書き確認 | 同一ISBNの書籍が既に登録済み | 1. 同じISBNで別のファイルを登録しようとする | 重複ISBNの警告が表示され、上書き確認ダイアログが表示される。ユーザーが承認した場合のみ既存ファイルが上書きされる | 重要 |

---

### 3.2 ライブラリ閲覧 (Browser)

#### 3.2.1 一覧表示

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| BRW-001 | 管理対象書籍の一覧取得 | 複数冊の書籍が登録済み | 1. ライブラリ一覧画面を開く | `MyLibrary` フォルダ配下の `app_type=my_library_book` プロパティを持つファイルのみが一覧に表示される | 必須 |
| BRW-002 | グリッド形式の表示 | 複数冊の書籍が登録済み | 1. ライブラリ一覧画面を開く | 書籍がグリッドレイアウト（カード形式）で表示される | 必須 |
| BRW-004 | カバー画像（サムネイル）の表示 | カバー画像がGoogle Driveに保存された書籍が登録済み | 1. ライブラリ一覧画面を開く | 各書籍のカバー画像（Google Driveに保存済み）がサムネイルとして目立つ形で表示される | 必須 |
| BRW-005 | カバー画像がない場合のフォールバック | カバー画像URLが未設定の書籍が登録済み | 1. ライブラリ一覧画面を開く | プレースホルダー画像（デフォルト画像）が表示され、レイアウトが崩れない | 重要 |
| BRW-006 | 書誌情報の表示 | 書籍が登録済み | 1. ライブラリ一覧画面で各書籍カードを確認する | タイトル、著者名が少なくとも表示されている | 必須 |
| BRW-007 | 0冊の状態での一覧表示 | 書籍が1冊も登録されていない | 1. ライブラリ一覧画面を開く | 空の一覧が表示され、「書籍がありません」等のメッセージ、または登録画面への誘導が表示される | 重要 |
| BRW-008 | 大量書籍の一覧表示 | 50冊以上の書籍が登録済み | 1. ライブラリ一覧画面を開く | Google Drive APIの `nextPageToken` を利用したページネーションにより、全件が閲覧可能である | 重要 |
| BRW-009 | 非管理対象ファイルの除外 | Google Driveに `app_type` プロパティを持たないファイルが存在する | 1. ライブラリ一覧画面を開く | `MyLibrary` フォルダ外のファイル、および `app_type=my_library_book` を持たないファイルは一覧に表示されない | 必須 |

#### 3.2.2 検索機能

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| SRC-001 | タイトルによる検索 | 複数冊の書籍が登録済み | 1. 検索バーに書籍タイトルの一部を入力する | 入力したキーワードにマッチする書籍のみが表示される（※Google Drive APIの`q`パラメータ検索で実現可能な範囲での一致） | 必須 |
| SRC-002 | 著者名による検索 | 複数著者の書籍が登録済み | 1. 検索バーに著者名を入力する | 該当著者の書籍のみが表示される（※Google Drive APIの`q`パラメータ検索で実現可能な範囲での一致） | 必須 |
| SRC-003 | ファイル名による検索 | 書籍が登録済み | 1. 検索バーにファイル名の一部を入力する | ファイル名にマッチする書籍が表示される（※Google Drive APIの`q`パラメータ検索で実現可能な範囲での一致） | 必須 |
| SRC-004 | 検索結果が0件の場合 | 書籍が登録済み | 1. 存在しないキーワードで検索する | 「検索結果がありません」等のメッセージが表示される | 必須 |
| SRC-006 | 検索クエリのDrive API変換確認 | 開発者ツール等でAPI呼び出しを確認可能 | 1. 検索を実行する<br>2. 発行されるDrive APIリクエストを確認する | Web画面の検索入力がGoogle Drive APIの `q` パラメータに適切に変換されている | 必須 |
| SRC-007 | 日本語での検索 | 日本語タイトル・著者名の書籍が登録済み | 1. 日本語キーワードで検索する | 日本語の書誌情報に対して正しく検索結果が返される | 必須 |
| SRC-008 | 検索結果のクリア | 検索結果が表示されている状態 | 1. 検索バーをクリアする | 全書籍の一覧表示に戻る | 重要 |

#### 3.2.3 ダウンロード

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| DWN-001 | EPUBファイルのダウンロード | EPUB形式の書籍が登録済み | 1. ライブラリ一覧で書籍をクリックする | ブラウザ標準のダウンロードが開始され、EPUBファイルが保存される | 必須 |
| DWN-002 | PDFファイルのダウンロード | PDF形式の書籍が登録済み | 1. ライブラリ一覧で書籍をクリックする | ブラウザ標準のダウンロードが開始され、PDFファイルが保存される | 必須 |
| DWN-003 | ダウンロードファイルの整合性 | 書籍が登録済み | 1. 書籍をダウンロードする<br>2. アップロード元のファイルとバイト比較する | ダウンロードしたファイルがアップロード元と同一である（破損がない） | 必須 |
| DWN-004 | ビューワー機能が存在しないことの確認 | 書籍が登録済み | 1. 書籍をクリックする | ブラウザ内でのビューワー（プレビュー）表示は行われず、ダウンロードのみが実行される | 必須 |

---

### 3.3 書籍削除

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| DEL-001 | 書籍の削除操作 | 書籍が1冊以上登録済み | 1. ライブラリ一覧画面で書籍の削除ボタンを押す | 削除確認ダイアログが表示される | 必須 |
| DEL-002 | 削除確認後の実行 | DEL-001で確認ダイアログが表示された状態 | 1. 確認ダイアログで「削除」を選択する | Google Drive上のファイル（書籍ファイルおよびカバー画像）が削除され、一覧から消える | 必須 |
| DEL-003 | 削除キャンセル | DEL-001で確認ダイアログが表示された状態 | 1. 確認ダイアログで「キャンセル」を選択する | 書籍が削除されず、一覧に残っている | 必須 |
| DEL-004 | 削除後のDriveデータ確認 | DEL-002で書籍が削除された状態 | 1. Google Drive上で該当ファイルを確認する | ファイルがDriveから削除されている（ゴミ箱に移動、またはDriveから完全削除） | 必須 |
| DEL-005 | 削除成功時のフィードバック | 書籍が登録済み | 1. 書籍を削除する | 削除成功のメッセージが表示される | 必須 |

---

### 3.4 書籍編集

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| EDT-001 | メタデータ編集画面の表示 | 書籍が1冊以上登録済み | 1. ライブラリ一覧画面で書籍の編集ボタンを押す | 現在のメタデータ（タイトル、著者名、出版社、出版日）がフォームに表示される | 必須 |
| EDT-002 | タイトルの編集 | EDT-001で編集画面が表示された状態 | 1. タイトルを変更する<br>2. 保存ボタンを押す | Google Drive上のカスタムプロパティ `title` が更新される。ファイル名も新しいタイトルに合わせてリネームされる | 必須 |
| EDT-003 | 著者名の編集 | EDT-001で編集画面が表示された状態 | 1. 著者名を変更する<br>2. 保存ボタンを押す | カスタムプロパティ `authors` が更新される。ファイル名およびフォルダ構成が新しい著者名に合わせて更新される | 必須 |
| EDT-004 | 出版社・出版日の編集 | EDT-001で編集画面が表示された状態 | 1. 出版社または出版日を変更する<br>2. 保存ボタンを押す | 該当するカスタムプロパティが更新される | 必須 |
| EDT-005 | 編集成功時のフィードバック | 書籍が登録済み | 1. メタデータを編集して保存する | 編集成功のメッセージが表示され、一覧画面に更新後の情報が反映される | 必須 |
| EDT-006 | 編集キャンセル | EDT-001で編集画面が表示された状態 | 1. キャンセルボタンを押す（または画面を離れる） | メタデータの変更が保存されず、元の状態のまま維持される | 必須 |

---

### 3.5 認証・設定

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| AUT-001 | Google Drive API認証（OAuth2またはService Account） | GCPプロジェクトが設定済み | 1. アプリを起動する<br>2. 認証フローを完了する | Google Drive APIへの認証が成功し、ファイル操作が可能になる | 必須 |
| AUT-002 | 認証トークンの永続化 | 一度OAuth2認証を完了した状態 | 1. アプリを再起動する | 再認証なしでDrive APIにアクセスできる（トークンが永続化されている） | 必須 |
| AUT-003 | 認証トークンの期限切れ時のリフレッシュ | トークンが期限切れになった状態 | 1. 一覧画面を開く等のAPI操作を行う | リフレッシュトークンにより自動的にアクセストークンが再取得される | 必須 |
| AUT-004 | 認証失敗時のエラー表示 | 不正な認証情報を設定した状態 | 1. アプリを起動する | 認証失敗の明確なエラーメッセージが表示され、対処方法が示唆される | 必須 |
| AUT-005 | LAN内オープンアクセス | アプリが起動している | 1. LAN内のブラウザからアプリのURLにアクセスする | 認証なしでアプリにアクセスできる（LAN内はオープンアクセス） | 必須 |

---

## 4. Phase 2: OPDS & Mobile Access 検収項目

### 4.1 OPDSサーバー

#### 4.1.1 OPDSカタログ生成

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| OPD-001 | OPDSエンドポイントの存在確認 | アプリが起動している | 1. ブラウザまたはcurlで `/opds` にアクセスする | HTTPステータス200でXMLが返される | 必須 |
| OPD-002 | OPDS 1.2準拠のAtom Feed形式 | 書籍が登録済み | 1. `/opds` にアクセスしてXMLを取得する<br>2. OPDS 1.2仕様と照合する | レスポンスのXMLがAtom Feed形式であり、OPDS 1.2規格に準拠している（`<feed>`, `<entry>` 等のタグ構造） | 必須 |
| OPD-003 | 書誌情報の含有確認 | 書籍が登録済み | 1. OPDSフィードのXMLを確認する | 各エントリに書籍のタイトル、著者名が含まれている | 必須 |
| OPD-004 | 書影（カバー画像）リンクの含有 | カバー画像がGoogle Driveに保存された書籍が登録済み | 1. OPDSフィードのXMLを確認する | 各エントリにGoogle Drive上のカバー画像へのリンクが含まれている | 必須 |
| OPD-005 | ダウンロードリンクとMIMEタイプ（EPUB） | EPUB形式の書籍が登録済み | 1. OPDSフィードのXMLを確認する | ダウンロードリンクの `type` 属性が `application/epub+zip` である | 必須 |
| OPD-006 | ダウンロードリンクとMIMEタイプ（PDF） | PDF形式の書籍が登録済み | 1. OPDSフィードのXMLを確認する | ダウンロードリンクの `type` 属性が `application/pdf` である | 必須 |
| OPD-007 | OPDSフィードからのダウンロード | リーダーアプリまたはcurlでOPDSフィードを取得 | 1. OPDSフィード内のダウンロードリンクにアクセスする | 書籍ファイルが正しくダウンロードされる | 必須 |
| OPD-008 | 0冊の状態でのOPDSフィード | 書籍が1冊も登録されていない | 1. `/opds` にアクセスする | 空のAtom Feedが返される（エラーにならない） | 重要 |

#### 4.1.2 OPDS検索

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| OPS-001 | OpenSearch記述の含有 | アプリが起動している | 1. OPDSフィードのXMLを確認する | OpenSearch記述（`<opensearch:...>` または OpenSearch Description Document へのリンク）が含まれている | 必須 |
| OPS-002 | OPDS経由の検索実行 | 書籍が登録済み | 1. OPDSリーダーアプリから検索を実行する（またはcurlで検索エンドポイントにリクエストする） | 検索キーワードにマッチする書籍のみを含むOPDSフィードが返される | 必須 |
| OPS-003 | OPDS検索のDrive API中継確認 | 書籍が登録済み | 1. OPDS検索リクエストを発行する | リーダーアプリからの検索リクエストがDrive API検索に適切に中継されている | 必須 |

#### 4.1.3 OPDSクライアント接続テスト

> **注記:** RDR-xxx項目はCLIツール（curl等）からの確認のみとする。iOS/Androidリーダーアプリでの確認は不要。

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| RDR-001 | OPDSカタログの取得確認 | アプリが起動している。書籍が登録済み | 1. curlで `/opds` にアクセスする<br>2. レスポンスのXMLを確認する | 有効なOPDS Atom Feedが返され、登録した書籍の一覧が含まれている | 重要 |
| RDR-002 | OPDSフィードからの書籍ダウンロード | RDR-001 が完了 | 1. OPDSフィード内のダウンロードリンクURLをcurlで取得する<br>2. ダウンロードしたファイルを確認する | 書籍ファイルが正しくダウンロードされる | 重要 |
| RDR-003 | OPDS検索の動作確認 | 書籍が登録済み | 1. curlでOPDS検索エンドポイントにリクエストを送る | 検索キーワードにマッチする書籍のみを含むOPDSフィードが返される | 重要 |

---

### 4.2 パフォーマンス最適化

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| PER-001 | インメモリキャッシュの動作確認 | 書籍が登録済み | 1. ライブラリ一覧画面を開く（初回アクセス）<br>2. 画面を再読み込みする（2回目アクセス） | 2回目のアクセスが1回目より高速である（Drive APIリクエストが発行されない、またはレスポンスがキャッシュから返される） | 必須 |
| PER-002 | キャッシュの有効期限（TTL: 1時間） | キャッシュが有効な状態 | 1. キャッシュの有効期限（1時間）を確認する<br>2. 有効期限経過後にアクセスする | 1時間経過後はDrive APIから最新データが取得される | 必須 |
| PER-003 | 新規登録時のキャッシュ更新 | キャッシュが有効な状態 | 1. 新しい書籍を登録する<br>2. ライブラリ一覧画面を開く | 新しく登録した書籍が一覧に表示される（キャッシュが適切に無効化または更新される） | 必須 |
| PER-004 | 検索結果のキャッシュ | 同じ検索を複数回実行 | 1. 同一キーワードで検索を2回行う | 2回目の検索が1回目より高速である | 重要 |

---

## 5. データ設計 検収項目

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| DAT-001 | 必須プロパティ `app_type` の存在 | 書籍が登録済み | 1. Drive APIでファイルのプロパティを取得する | `app_type` キーが存在し、値が `my_library_book` である | 必須 |
| DAT-002 | `isbn` プロパティの値形式 | ISBNを入力して登録した書籍 | 1. Drive APIでプロパティを確認する | `isbn` に13桁または10桁のISBN文字列が格納されている | 必須 |
| DAT-003 | `title` プロパティの値 | 書籍が登録済み | 1. Drive APIでプロパティを確認する | `title` に登録時に指定したタイトルが格納されている | 必須 |
| DAT-004 | `authors` プロパティの値（単一著者） | 著者が1名の書籍を登録 | 1. Drive APIでプロパティを確認する | `authors` に著者名が格納されている | 必須 |
| DAT-005 | `authors` プロパティの値（複数著者） | 著者が複数名の書籍を登録 | 1. Drive APIでプロパティを確認する | `authors` に複数著者名がハイフン `-` 区切りで格納されている（例: `著者A-著者B`） | 重要 |
| DAT-006 | `publisher` プロパティの値 | 書籍が登録済み | 1. Drive APIでプロパティを確認する | `publisher` に出版社名が格納されている | 必須 |
| DAT-007 | `published_date` プロパティの値形式 | 書籍が登録済み | 1. Drive APIでプロパティを確認する | `published_date` がソート可能な日付文字列形式（例: `YYYY-MM-DD`）で格納されている | 必須 |
| DAT-008 | プロパティ値の文字数制限確認 | 非常に長いタイトル（124バイト以上）の書籍を登録 | 1. 登録が成功するか確認する<br>2. Drive APIでプロパティを確認する | Google Driveのプロパティ値の制限（124バイト）を超える値が124バイト以内に切り詰められて保存される。登録自体はエラーにならない | 重要 |
| DAT-009 | MyLibraryルートフォルダの存在確認 | 初回起動時 | 1. アプリを初回起動する<br>2. Google Driveを確認する | `MyLibrary` フォルダが自動的に作成されている（または既存のものが使用される）。このフォルダがアプリの全管理対象の起点となる | 必須 |
| DAT-010 | 概要（description）の保存 | 概要が取得できる書籍を登録 | 1. Drive APIでファイル情報を確認する | 概要がカスタムプロパティまたはファイルの description フィールドのいずれかに保存されている（実装方式は問わない） | 重要 |
| DAT-011 | カバー画像ファイルの保存 | カバー画像URLが取得できる書籍を登録 | 1. Google Drive上で該当書籍のフォルダを確認する | カバー画像ファイルがGoogle Drive上に別ファイルとして保存されている | 必須 |

---

## 6. 非機能要件 検収項目

### 6.1 技術スタック

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| TEC-001 | Denoランタイムでの起動 | Denoがインストール済み | 1. `deno task start` 等でアプリを起動する | アプリがDenoランタイム上で正常に起動する | 必須 |
| TEC-002 | HonoフレームワークによるSSR | アプリが起動している | 1. ブラウザでアプリにアクセスする<br>2. ページソースを確認する | HTMLがサーバー側で生成（SSR）されている（クライアントサイドJSフレームワークによるレンダリングではない） | 必須 |
| TEC-003 | htmxによる動的更新 | アプリが起動している | 1. 検索やフォーム操作を行う<br>2. ネットワークタブでリクエストを確認する | ページ全体のリロードなしに、htmxのAJAXリクエストによる部分的なHTML更新が行われている | 必須 |
| TEC-004 | DaisyUIコンポーネントの使用 | アプリが起動している | 1. UIを確認する | DaisyUIのコンポーネントクラス（`btn`, `card`, `input` 等）が使用されている | 必須 |

### 6.2 動作環境

| ID | テスト項目 | 前提条件 | 手順 | 期待結果 | 優先度 |
|----|-----------|---------|------|---------|--------|
| ENV-001 | LAN内からのアクセス | 同一LAN内のPCを用意 | 1. LAN内の別端末のブラウザからアプリのIPアドレス+ポートにアクセスする | アプリが正常に表示・操作できる | 必須 |
| ENV-004 | レスポンス速度の許容範囲 | 書籍が登録済み、通常のインターネット接続 | 1. 一覧表示のレスポンス時間を計測する<br>2. 検索のレスポンス時間を計測する | 数百ミリ秒〜数秒以内にレスポンスが返される（要件定義書で許容済み） | 重要 |
| ENV-006 | 対応ブラウザ（Chrome最新版） | Chrome最新版がインストール済み | 1. Chrome最新版でアプリの全機能を操作する | 全機能が正常に動作する。動作保証はChrome最新版のみとする | 必須 |

---

## 7. 総合試験シナリオ

以下のシナリオは、複数機能を横断する**End-to-Endテスト**であり、システム全体の動作を検証する。

### シナリオ1: 書籍の新規登録から閲覧・ダウンロードまで

| Step | 操作 | 期待結果 |
|------|------|---------|
| 1 | アプリにアクセスし、書籍登録画面を開く | 登録フォームが表示される |
| 2 | ISBN `9784101010014` を入力する | 書誌情報（太宰治「人間失格」等）が自動補完される |
| 3 | 書誌情報を確認し、必要に応じて修正する | 修正した内容がフォームに反映される |
| 4 | EPUBファイルを選択する | ファイルが選択状態になる |
| 5 | 「登録」ボタンを押す | アップロードが開始され、完了後に成功メッセージが表示される |
| 6 | ライブラリ一覧画面に移動する | 先ほど登録した書籍がカバー画像付きで表示される |
| 7 | 該当書籍をクリックする | ブラウザのダウンロードが開始される |
| 8 | ダウンロードしたファイルを確認する | アップロードしたファイルと同一の内容である |

### シナリオ2: 複数書籍の登録と検索

| Step | 操作 | 期待結果 |
|------|------|---------|
| 1 | 異なる著者の書籍を3冊登録する（著者A×2冊、著者B×1冊） | 全3冊が登録成功する |
| 2 | ライブラリ一覧画面を開く | 3冊すべてが表示される |
| 3 | 著者Aの名前で検索する | 著者Aの2冊のみが表示される |
| 4 | 検索バーをクリアする | 全3冊が再表示される |
| 5 | 著者Bの書籍のタイトルで検索する | 著者Bの1冊のみが表示される |
| 6 | 存在しないキーワードで検索する | 「検索結果がありません」のメッセージが表示される |

### シナリオ3: 書籍の編集と削除

| Step | 操作 | 期待結果 |
|------|------|---------|
| 1 | 書籍を1冊登録する | 登録成功 |
| 2 | ライブラリ一覧画面で該当書籍の編集ボタンを押す | 編集画面が表示され、現在のメタデータがフォームに表示される |
| 3 | タイトルを変更して保存する | 変更が保存され、一覧画面に新しいタイトルが表示される |
| 4 | Google Drive上でファイル名を確認する | ファイル名が新しいタイトルに合わせてリネームされている |
| 5 | ライブラリ一覧画面で該当書籍の削除ボタンを押す | 削除確認ダイアログが表示される |
| 6 | 確認ダイアログで「削除」を選択する | 書籍が一覧から消え、削除成功のメッセージが表示される |
| 7 | Google Drive上で該当ファイルを確認する | ファイルがDriveから削除されている |

### シナリオ4: Google Driveのデータ整合性確認

| Step | 操作 | 期待結果 |
|------|------|---------|
| 1 | アプリから書籍を1冊登録する | 登録成功 |
| 2 | Google Drive Web UIで `/MyLibrary` フォルダを開く | 著者名フォルダ配下に `[著者名] タイトル.拡張子` のファイルとカバー画像ファイルが存在する |
| 3 | ファイルのプロパティ（詳細情報）を確認する | `app_type`, `isbn`, `title`, `authors`, `publisher`, `published_date` が正しく設定されている |
| 4 | アプリのライブラリ一覧画面を開く | 同じ書籍がカバー画像付きで表示される |

### シナリオ5: OPDSカタログのCLI確認（Phase 2）

| Step | 操作 | 期待結果 |
|------|------|---------|
| 1 | 書籍を複数冊登録する | 登録成功 |
| 2 | curlで `http://<server>/opds` にアクセスする | 有効なOPDS Atom Feed XMLが返される |
| 3 | XMLの内容を確認する | 登録した書籍の一覧が含まれている（書誌情報、書影リンク、ダウンロードリンク付き） |
| 4 | curlでOPDS検索エンドポイントにリクエストを送る | マッチする書籍のみを含むフィードが返される |
| 5 | curlでダウンロードリンクにアクセスする | 書籍ファイルが正しくダウンロードされる |

### シナリオ6: キャッシュ動作の確認（Phase 2）

| Step | 操作 | 期待結果 |
|------|------|---------|
| 1 | ライブラリ一覧画面を開く（キャッシュなし状態） | 書籍一覧が表示される（Drive APIが呼び出される） |
| 2 | 画面をリロードする | 書籍一覧が表示される（キャッシュから返され、レスポンスが高速） |
| 3 | 新しい書籍を登録する | 登録成功 |
| 4 | ライブラリ一覧画面を開く | 新しい書籍を含む最新の一覧が表示される（キャッシュが更新されている） |

